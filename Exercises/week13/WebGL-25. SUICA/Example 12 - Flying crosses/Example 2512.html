<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<title>Летящи кръстачки</title>

	<style>
		body	{ text-align: center; }
		canvas	{ border: solid 1px; }
	</style>

	<script src="suica.min.js"></script>

	<script>
		function main()
		{
			p = new Suica();
			background([0,0,0]);
			lookAt ([120,0,0],[0,0,0],[0,0,1]);
			
			p.gl.canvas.addEventListener('mousedown',mouseDown,false);
			
			n = 50;
			cross = [];
			for (var i=0; i<n; i++)
			{
				cross[i] =
					group(
					  [	cuboid([0,0,0],[10,2,2]),
						cuboid([0,0,0],[2,10,2]),
						cuboid([0,0,0],[2,2,10])])
					.custom({
						interactive: true,
						color: [1,0,0.2],
						sizes: [2,2,2],
						offset: random(0,10*Math.PI),
						speed: random(1,2),
						shrink: false});
				cross[i].merge();
				cross[i].mergeColor();
			}
			
			p.nextFrame = animate;
		}

		function mouseDown(event)
		{
			obj = p.objectAtPoint(event.clientX,event.clientY);
			if (obj)
			{
				obj.color = [0.8,0.8,0.8];
				obj.shrink = true;
			}
		}
		
		cos = Math.cos;
		sin = Math.sin;
		
		function animate()
		{
			for (var i = 0; i<n; i++)
			{
				t = Suica.time/3*cross[i].speed+cross[i].offset;
				cross[i].center = [40*cos(t),40*sin(t),15*cos(1.5*t+i)];
				cross[i].focus = [cos(2*t),sin(1.3*t),sin(-1.5*t)];
				cross[i].spin = (t-i)*cross[i].speed;
				if (cross[i].shrink)
				{
					var s = cross[i].sizes[0]*0.9+0.1*1;
					cross[i].sizes = [s,s,s];
				}
			}
		}
	</script>	
</head>

<body onload="main()">
	<h2>Летящи кръстачки</h2>
	
	<canvas width="600" height="400"></canvas>
</body>
